import requests
import time

def deep_search_all_eth_15m_global():
    print("üåç –ù–∞—á–∏–Ω–∞—é –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ø–æ–∏—Å–∫ (–±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π) —Ä—ã–Ω–∫–æ–≤ ETH 15m...")
    
    url = "https://gamma-api.polymarket.com/events"
    limit = 10000
    offset = 0
    page = 1
    all_found_events = []

    while True:
        print(f"üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ {page} (—Ä—ã–Ω–∫–∏ {offset} - {offset + limit})...")
        
        try:
            # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–ï–ó "tag_id"
            params = {
                "active": "true",    
                "closed": "false",   
                "limit": limit,
                "offset": offset,
                "order": "startDate", 
                "ascending": "false"
            }
            
            resp = requests.get(url, params=params, timeout=10)
            if resp.status_code != 200:
                print(f"‚ùå –û—à–∏–±–∫–∞ API: {resp.status_code}")
                time.sleep(2)
                continue

            events = resp.json()
            
            if not events:
                print("üèÅ –°—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–Ω—á–∏–ª–∏—Å—å.")
                break 

            for event in events:
                slug = event.get('slug', '')
                # –ò—â–µ–º 'eth' –∏ '15m'
                if 'eth' in slug and '15m' in slug:
                    print(f"üéâ –ù–ê–®–ï–õ –Ω–∞ —Å—Ç—Ä. {page}: {slug}")
                    all_found_events.append(event)

            if len(events) < limit:
                 print("üèÅ –î–æ—Å—Ç–∏–≥–Ω—É—Ç –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞.")
                 break

            offset += limit
            page += 1
            time.sleep(1) # 1 –∑–∞–ø—Ä–æ—Å –≤ —Å–µ–∫—É–Ω–¥—É

        except Exception as e:
            print(f"üí• –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: {e}")
            time.sleep(5)

    print(f"\n‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω. –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ: {len(all_found_events)}")
    return all_found_events

# --- –ó–ê–ü–£–°–ö ---
global_eth_markets = deep_search_all_eth_15m_global()

print("\n--- –ò—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ —Å—Å—ã–ª–æ–∫ (Global) ---")
for event in global_eth_markets:
    print(f"https://polymarket.com/event/{event.get('slug')}")